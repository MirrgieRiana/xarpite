{"version":3,"sources":["../../../../../../src/jsMain/kotlin/mirrg/xarpite/js/browser/JsBrowserMain.kt","../../../../../../src/jsMain/kotlin/mirrg/xarpite/js/browser/JsBrowserMounts.kt"],"sourcesContent":["package mirrg.xarpite.js.browser\n\nimport kotlinx.coroutines.await\nimport kotlinx.coroutines.promise\nimport mirrg.xarpite.Evaluator\nimport mirrg.xarpite.compilers.objects.FluoriteStream\nimport mirrg.xarpite.compilers.objects.FluoriteValue\nimport mirrg.xarpite.compilers.objects.collect\nimport mirrg.xarpite.compilers.objects.toFluoriteString\nimport mirrg.xarpite.js.createJsMounts\nimport mirrg.xarpite.js.scope\nimport mirrg.xarpite.mounts.createCommonMounts\nimport kotlin.js.Promise\n\n@OptIn(ExperimentalJsExport::class)\n@JsExport\nfun evaluate(src: String, quiet: Boolean, out: (dynamic) -> Promise<Unit>): Promise<dynamic> = scope.promise {\n    val evaluator = Evaluator()\n    val defaultBuiltinMounts = listOf(\n        createCommonMounts(scope) { out(it).await() },\n        createJsMounts(),\n        createJsBrowserMounts(),\n    ).flatten()\n    evaluator.defineMounts(defaultBuiltinMounts)\n    if (quiet) {\n        evaluator.run(src)\n        undefined\n    } else {\n        evaluator.get(src)\n    }\n}\n\n@OptIn(ExperimentalJsExport::class)\n@JsExport\nfun log(value: dynamic): Promise<Unit> = scope.promise {\n    val value = value.unsafeCast<FluoriteValue>()\n    if (value is FluoriteStream) {\n        value.collect {\n            console.log(it)\n        }\n    } else {\n        console.log(value)\n    }\n}\n\n@OptIn(ExperimentalJsExport::class)\n@JsExport\nfun stringify(value: dynamic): Promise<String> = scope.promise {\n    val value = value.unsafeCast<FluoriteValue>()\n    suspend fun f(value: FluoriteValue): String {\n        return if (value is FluoriteStream) {\n            val sb = StringBuilder()\n            var isFirst = true\n            value.collect {\n                if (isFirst) {\n                    isFirst = false\n                } else {\n                    sb.append('\\n')\n                }\n                sb.append(f(it))\n            }\n            sb.toString()\n        } else {\n            value.toFluoriteString().value\n        }\n    }\n    f(value)\n}\n","package mirrg.xarpite.js.browser\n\nimport kotlinx.browser.window\nimport mirrg.xarpite.compilers.objects.FluoriteNull\nimport mirrg.xarpite.compilers.objects.FluoriteValue\nimport mirrg.xarpite.js.FluoriteJsObject\n\nfun createJsBrowserMounts(): List<Map<String, FluoriteValue>> {\n    return mapOf(\n        \"WINDOW\" to try {\n            FluoriteJsObject(window)\n        } catch (_: Throwable) { // \u30c6\u30b9\u30c8\u74b0\u5883\u3067\u306f\u5229\u7528\u3067\u304d\u306a\u3044\n            FluoriteNull\n        },\n    ).let { listOf(it) }\n}\n"],"ignoreList":[],"x_google_ignoreList":[],"names":["evaluate","src","quiet","out","log","value","stringify","$out","invoke","$completion","doResume","evaluate$slambda$slambda","evaluate$slambda$slambda$lambda","$quiet","$src","evaluate$slambda","evaluate$slambda$lambda","log$slambda$slambda","log$slambda$slambda$lambda","$value","log$slambda","log$slambda$lambda","invoke$f","$isFirst","$sb","stringify$slambda$f$slambda","stringify$slambda$f$slambda$lambda","stringify$slambda","stringify$slambda$lambda","createJsBrowserMounts","<unused var>"],"mappings":"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"}