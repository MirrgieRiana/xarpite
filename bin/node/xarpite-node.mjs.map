{"version":3,"sources":["../../../../../../src/jsMain/kotlin/mirrg/xarpite/js/node/JsNodeMain.kt","src/kotlin/util/Lazy.kt","common/src/generated/_Arrays.kt","../../../../../../src/jsMain/kotlin/mirrg/xarpite/js/node/JsNodeUtils.kt"],"sourcesContent":["package mirrg.xarpite.js.node\n\nimport envGetter\nimport fileSystemGetter\nimport kotlinx.coroutines.await\nimport kotlinx.coroutines.channels.ReceiveChannel\nimport kotlinx.coroutines.coroutineScope\nimport kotlinx.coroutines.flow.flow\nimport kotlinx.coroutines.flow.produceIn\nimport mirrg.xarpite.cli.ShowUsage\nimport mirrg.xarpite.cli.main\nimport mirrg.xarpite.cli.parseArguments\nimport mirrg.xarpite.cli.showUsage\nimport mirrg.xarpite.js.Object_keys\nimport mirrg.xarpite.js.createJsMounts\nimport mirrg.xarpite.js.scope\nimport okio.NodeJsFileSystem\nimport readLineFromStdinImpl\nimport kotlin.js.Promise\n\nsuspend fun main() {\n    envGetter = {\n        val env = process.env\n        Object_keys(env).associateWith { env[it].unsafeCast<String>() }\n    }\n    fileSystemGetter = { NodeJsFileSystem }\n    readLineFromStdinImpl = { readLineFromStdinIterator.receiveCatching().getOrNull() }\n\n    val options = try {\n        parseArguments(process.argv.drop(2))\n    } catch (_: ShowUsage) {\n        showUsage()\n        return\n    }\n    coroutineScope {\n        main(options, this) {\n            createJsMounts()\n        }\n    }\n}\n\nval readLineFromStdinIterator: ReceiveChannel<String> by lazy {\n    flow {\n        process.stdin.setEncoding(\"utf8\")\n        val stringIterator = js(\"(function(x) { return x[Symbol.asyncIterator](); })\")(process.stdin)\n        val sb = StringBuilder()\n        var afterR = false\n        while (true) {\n            val result = stringIterator.next().unsafeCast<Promise<dynamic>>().await()\n            if (result.done) {\n                if (sb.isNotEmpty()) {\n                    emit(sb.toString())\n                    sb.clear()\n                }\n                break\n            }\n            val string = result.value.unsafeCast<String>()\n            var index = 0\n            while (index < string.length) {\n                if (afterR && string[index] == '\\n') {\n                    index++\n                    afterR = false\n                    continue\n                }\n                val r = string.indexOf('\\r', index)\n                val n = string.indexOf('\\n', index)\n                val lineEnd = if (r == -1) n else if (n == -1) r else minOf(r, n)\n                if (lineEnd == -1) {\n                    sb.append(string.substring(index))\n                    index = string.length\n                    afterR = false\n                } else {\n                    sb.append(string.substring(index, lineEnd))\n                    emit(sb.toString())\n                    sb.clear()\n                    index = lineEnd + 1\n                    afterR = string[lineEnd] == '\\r'\n                }\n            }\n        }\n    }.produceIn(scope)\n}\n",null,null,"package mirrg.xarpite.js.node\n\nimport kotlin.js.Json\n\nexternal class Process {\n    val env: Json\n    val argv: Array<String>\n    val stdin: dynamic\n}\n\nval process by lazy { js(\"process\").unsafeCast<Process>() }\n"],"ignoreList":[],"x_google_ignoreList":[],"names":["<get-readLineFromStdinIterator>","main","$completion","<unused var>","options","readLineFromStdinIterator$delegate$lambda","invoke","doResume","x","readLineFromStdinIterator$delegate$lambda$slambda","readLineFromStdinIterator$delegate$lambda$slambda$lambda","main$lambda","env","result","element","main$slambda","main$slambda$lambda","$options","<init properties JsNodeMain.kt>","<get-process>","process$delegate$lambda","<init properties JsNodeUtils.kt>"],"mappings":"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"}