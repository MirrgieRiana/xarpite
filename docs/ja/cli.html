<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>CLI - Xarpite</title>
    <meta name="description" content="An interpreted language for one-liners">
    <link rel="stylesheet" href="/xarpite/assets/css/style.css">
    <link rel="icon" type="image/svg+xml" href="/xarpite/assets/images/xarpite-icon.svg">
    <script src="/xarpite/assets/js/main.js" defer></script>
</head>
<body>
<div class="page-wrapper">
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <a href="/xarpite/" class="logo-link">
                    <img src="/xarpite/assets/images/xarpite-icon.svg" alt="Xarpite Icon" class="logo-icon">
                    <span class="logo-text">Xarpite</span>
                </a>
                <nav class="main-nav">
                    <a href="/xarpite/docs/ja/" class="nav-link">ドキュメント</a>
                    <a href="https://github.com/MirrgieRiana/xarpite" class="nav-link" target="_blank">GitHub</a>
                    <a href="https://mirrgieriana.github.io/xarpite/playground/" class="nav-link playground-link" target="_blank">Playground</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="content-wrapper">
                <aside class="sidebar">
                    
                    <nav class="doc-nav">
  <h3 class="nav-title">ドキュメント</h3>
  <ul class="nav-list">
    <li><a href="/xarpite/docs/ja/">トップ</a></li>
    <li><a href="/xarpite/docs/ja/syntax.html">文法</a></li>
    <li><a href="/xarpite/docs/ja/statement.html">文・式</a></li>
    <li><a href="/xarpite/docs/ja/whitespace.html">空白・コメント</a></li>
    <li><a href="/xarpite/docs/ja/variable.html">変数</a></li>
    <li><a href="/xarpite/docs/ja/number.html">数値</a></li>
    <li><a href="/xarpite/docs/ja/string.html">文字列</a></li>
    <li><a href="/xarpite/docs/ja/regex.html">正規表現</a></li>
    <li><a href="/xarpite/docs/ja/blob.html">BLOB</a></li>
    <li><a href="/xarpite/docs/ja/comparison.html">比較</a></li>
    <li><a href="/xarpite/docs/ja/boolean.html">論理値・条件分岐</a></li>
    <li><a href="/xarpite/docs/ja/control-structures.html">制御構文</a></li>
    <li><a href="/xarpite/docs/ja/jump.html">リターン・エラー処理</a></li>
    <li><a href="/xarpite/docs/ja/property.html">プロパティアクセス</a></li>
    <li><a href="/xarpite/docs/ja/array.html">配列</a></li>
    <li><a href="/xarpite/docs/ja/object.html">オブジェクト</a></li>
    <li><a href="/xarpite/docs/ja/length.html">長さ</a></li>
    <li><a href="/xarpite/docs/ja/function.html">関数</a></li>
    <li><a href="/xarpite/docs/ja/stream.html">ストリーム・代入・パイプ系演算子</a></li>
    <li><a href="/xarpite/docs/ja/builtin.html">組み込み定数・関数</a></li>
    <li><a href="/xarpite/docs/ja/data-conversion.html">データ変換系関数</a></li>
    <li><a href="/xarpite/docs/ja/samples.html">サンプル</a></li>
    <li><a href="/xarpite/docs/ja/cli.html">コマンドラインツール</a></li>
    <li><a href="/xarpite/docs/ja/js.html">JavaScript版</a></li>
    <li><a href="/xarpite/docs/ja/coroutine.html">コルーチン</a></li>
    <li><a href="/xarpite/docs/ja/json.html">JSON操作</a></li>
  </ul>
</nav>

                </aside>

                <article class="doc-content">
                    
                    
                        
                        
                        
                        
                            <h1 id="cli">CLI</h1>

<p>Xarpiteはコマンドラインインターフェース（CLI）を通じて実行できます。</p>

<p>ブラウザ版にはない、CLI版限定の機能や概念がいくつか存在します。</p>

<div class="table-of-contents">
  <ul id="markdown-toc"><li><a href="#cli">CLI</a><ul id="markdown-toc"><li><a href="#ランチャーとランタイム">ランチャーとランタイム</a></li><li><a href="#xarpiteを実行するコマンド">Xarpiteを実行するコマンド</a><ul id="markdown-toc"><li><a href="#xarpite-xarpiteを実行する基本的なコマンド">xarpite: Xarpiteを実行する基本的なコマンド</a></li><li><a href="#xa-xarpiteを手元で実行する便利なショートカット">xa: Xarpiteを手元で実行する便利なショートカット</a></li></ul></li><li><a href="#xarpiteエンジンの指定">Xarpiteエンジンの指定</a><ul id="markdown-toc"><li><a href="#xarpite_engine-xarpiteエンジンを指定する環境変数">XARPITE_ENGINE: Xarpiteエンジンを指定する環境変数</a></li></ul></li><li><a href="#xarpiteエンジンを指定するコマンドラインオプション">Xarpiteエンジンを指定するコマンドラインオプション</a><ul id="markdown-toc"><li><a href="#--native-ネイティブ実装エンジンを使用">--native: ネイティブ実装エンジンを使用</a></li><li><a href="#--jvm-jvmエンジンを使用">--jvm: JVMエンジンを使用</a></li><li><a href="#--node-nodejsエンジンを使用">--node: Node.jsエンジンを使用</a></li></ul></li><li><a href="#戻り値の出力">戻り値の出力</a><ul id="markdown-toc"><li><a href="#-q-戻り値の出力の抑制">-q: 戻り値の出力の抑制</a></li></ul></li><li><a href="#スクリプトの指定">スクリプトの指定</a><ul id="markdown-toc"><li><a href="#-f-ファイルからスクリプトを読み込む">-f: ファイルからスクリプトを読み込む</a></li><li><a href="#-e-スクリプトを直接実行">-e: スクリプトを直接実行</a></li></ul></li><li><a href="#その他のコマンド">その他のコマンド</a><ul id="markdown-toc"><li><a href="#xarpite-update-xarpiteを最新版に更新する">xarpite-update: Xarpiteを最新版に更新する</a></li></ul></li><li><a href="#cli版限定組み込み定数関数">CLI版限定組み込み定数・関数</a><ul id="markdown-toc"><li><a href="#args-コマンドライン引数を取得">ARGS: コマンドライン引数を取得</a></li><li><a href="#env-環境変数を取得">ENV: 環境変数を取得</a></li><li><a href="#in-コンソールから文字列を1行ずつ読み取る">IN: コンソールから文字列を1行ずつ読み取る</a></li><li><a href="#inb-コンソールからバイトデータを読み取る">INB: コンソールからバイトデータを読み取る</a></li><li><a href="#out-コンソールに出力">OUT: コンソールに出力</a></li><li><a href="#outb-バイトデータをコンソールに出力">OUTB: バイトデータをコンソールに出力</a></li><li><a href="#files-ディレクトリ内のファイルの一覧を取得">FILES: ディレクトリ内のファイルの一覧を取得</a></li><li><a href="#read-ファイルから読み込み">READ: ファイルから読み込み</a></li><li><a href="#use-外部xarpiteファイルの結果を取得">USE: 外部Xarpiteファイルの結果を取得</a></li><li><a href="#exec-外部コマンドを実行-experimental">EXEC: 外部コマンドを実行 [EXPERIMENTAL]</a></li></ul></li></ul></li></ul>
</div>


<h2 id="ランチャーとランタイム">ランチャーとランタイム</h2>

<p>CLI上でXarpiteを実行する際には、ランチャーとランタイムという2つのレイヤーが存在します。</p>

<hr />

<p>ランチャーとは <code class="language-plaintext highlighter-rouge">xarpite</code> コマンドを直接受け付けるシェルスクリプトを指します。</p>

<p>ランチャーは環境変数や引数などに基づいて実際に起動すべきランタイムの決定とその起動を行います。</p>

<hr />

<p>ランタイムとはXarpiteスクリプトを実際に動作させるプログラムを指します。</p>

<p>ランタイムには複数のプラットフォームによる異なる実装があり、これはXarpiteエンジンと呼ばれます。</p>

<h2 id="xarpiteを実行するコマンド">Xarpiteを実行するコマンド</h2>

<h3 id="xarpite-xarpiteを実行する基本的なコマンド"><code class="language-plaintext highlighter-rouge">xarpite</code>: Xarpiteを実行する基本的なコマンド</h3>

<p><code class="language-plaintext highlighter-rouge">xarpite</code> コマンドはXarpiteを実行するための最も基本的なコマンドです。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xarpite <span class="nt">-h</span>
<span class="c"># Usage: xarpite &lt;Launcher Options&gt; &lt;Runtime Options&gt; [--] [scriptfile] &lt;arguments&gt;</span>
<span class="c"># Launcher Options:</span>
<span class="c">#   --native                 Use the native engine</span>
<span class="c">#   --jvm                    Use the JVM engine</span>
<span class="c">#   --node                   Use the Node.js engine</span>
<span class="c"># Runtime Options:</span>
<span class="c">#   -h, --help               Show this help</span>
<span class="c">#   -q                       Run script as a runner</span>
<span class="c">#   -f &lt;scriptfile&gt;          Read script from file</span>
<span class="c">#                            Omit [scriptfile]</span>
<span class="c">#   -e &lt;script&gt;              Evaluate script directly</span>
<span class="c">#                            Omit [scriptfile]</span>
</code></pre></div></div>

<hr />

<p><code class="language-plaintext highlighter-rouge">Launcher Options</code> はランチャー側で、 <code class="language-plaintext highlighter-rouge">Runtime Options</code> はランタイム側で解釈されます。</p>

<p>このため、両者は順序を入れ替えて指定することはできません。</p>

<hr />

<p><code class="language-plaintext highlighter-rouge">xarpite</code> コマンドはシバン行によってXarpiteスクリプトを直接実行するためにも利用できます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="o">{</span>
  <span class="nb">echo</span> <span class="s1">'#!/usr/bin/env xarpite'</span> <span class="o">&gt;</span> script.xa1
  <span class="nb">echo</span> <span class="s1">'100 + 20 + 3'</span> <span class="o">&gt;&gt;</span> script.xa1
  <span class="nb">chmod</span> +x script.xa1

  ./script.xa1

  <span class="nb">rm </span>script.xa1
<span class="o">}</span>
<span class="c"># 123</span>
</code></pre></div></div>

<h3 id="xa-xarpiteを手元で実行する便利なショートカット"><code class="language-plaintext highlighter-rouge">xa</code>: Xarpiteを手元で実行する便利なショートカット</h3>

<p><code class="language-plaintext highlighter-rouge">xa</code> コマンドは <code class="language-plaintext highlighter-rouge">xarpite</code> コマンドのショートカットです。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="nt">-h</span>
<span class="c"># Usage: xa &lt;Launcher Options&gt; &lt;Runtime Options&gt; [--] [script] &lt;arguments&gt;</span>
<span class="c"># Launcher Options:</span>
<span class="c">#   --native                 Use the native engine</span>
<span class="c">#   --jvm                    Use the JVM engine</span>
<span class="c">#   --node                   Use the Node.js engine</span>
<span class="c"># Runtime Options:</span>
<span class="c">#   -h, --help               Show this help</span>
<span class="c">#   -q                       Run script as a runner</span>
<span class="c">#   -f &lt;scriptfile&gt;          Read script from file</span>
<span class="c">#                            Omit [script]</span>
<span class="c">#   -e &lt;script&gt;              Evaluate script directly</span>
<span class="c">#                            Omit [script]</span>
</code></pre></div></div>

<hr />

<p><code class="language-plaintext highlighter-rouge">xarpite</code> コマンドと概ね同じ仕様ですが、以下の点で重要な違いがあります。</p>

<ul>
  <li>文字数が2文字と非常に短い。</li>
  <li>第一引数がデフォルトでXarpiteスクリプトファイルではなくXarpiteスクリプトそのものとして解釈される。</li>
  <li><strong>Xarpite2などが出た場合、同じ <code class="language-plaintext highlighter-rouge">xa</code> コマンドが使われる可能性がある。</strong></li>
</ul>

<hr />

<p>大雑把に言えば、人間が手元のコンソール上で使うための便利なコマンドです。</p>

<p><code class="language-plaintext highlighter-rouge">xa</code> コマンドを使えば非常に少ない記述量で簡単な計算をすることができます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="s1">'100 + 20 + 3'</span>
<span class="c"># 123</span>
</code></pre></div></div>

<hr />

<p>一方で、 <code class="language-plaintext highlighter-rouge">xa</code> コマンドはシェルスクリプトなどのファイル内に記述する利用法を想定していません。</p>

<p>その目的には代わりに <code class="language-plaintext highlighter-rouge">xarpite</code> コマンドを使用してください。</p>

<h2 id="xarpiteエンジンの指定">Xarpiteエンジンの指定</h2>

<h3 id="xarpite_engine-xarpiteエンジンを指定する環境変数"><code class="language-plaintext highlighter-rouge">XARPITE_ENGINE</code>: Xarpiteエンジンを指定する環境変数</h3>

<p><code class="language-plaintext highlighter-rouge">XARPITE_ENGINE</code> 環境変数はXarpiteの実行エンジンを指定します。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">native</code>: ネイティブ実装を使用</li>
  <li><code class="language-plaintext highlighter-rouge">jvm</code>: JVMを使用</li>
  <li><code class="language-plaintext highlighter-rouge">node</code>: Node.jsを使用</li>
</ul>

<hr />

<p>一部の機能は特定のエンジンでのみ利用可能です。</p>

<hr />

<p><code class="language-plaintext highlighter-rouge">XARPITE_ENGINE</code> 環境変数が指定されていない場合、設定ファイル <code class="language-plaintext highlighter-rouge">default_engine</code> の内容が使用されます。</p>

<p>通常、この設定ファイルはXarpiteのインストール時に作成されます。</p>

<p>この設定ファイルも存在しない場合、デフォルトで <code class="language-plaintext highlighter-rouge">native</code> エンジンが使用されます。</p>

<hr />

<p>コマンドラインオプションによるXarpiteエンジンの指定は環境変数による指定よりも優先されます。</p>

<h2 id="xarpiteエンジンを指定するコマンドラインオプション">Xarpiteエンジンを指定するコマンドラインオプション</h2>

<p>Xarpiteエンジンを指定するコマンドラインオプションは排他的であり、複数を同時に指定することはできません。</p>

<h3 id="--native-ネイティブ実装エンジンを使用"><code class="language-plaintext highlighter-rouge">--native</code>: ネイティブ実装エンジンを使用</h3>

<p>ネイティブコンパイルされたXarpiteエンジンを使用します。</p>

<h3 id="--jvm-jvmエンジンを使用"><code class="language-plaintext highlighter-rouge">--jvm</code>: JVMエンジンを使用</h3>

<p>JVM上で動作するXarpiteエンジンを使用します。</p>

<h3 id="--node-nodejsエンジンを使用"><code class="language-plaintext highlighter-rouge">--node</code>: Node.jsエンジンを使用</h3>

<p>Node.js上で動作するXarpiteエンジンを使用します。</p>

<h2 id="戻り値の出力">戻り値の出力</h2>

<p>CLI版Xarpiteでは、標準の動作としてプログラム全体の戻り値を標準出力に出力します。</p>

<hr />

<p>この際、出力値の文字列化が行われます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="s1">'
  Object := {
    new: () -&gt; Object{}
    `&amp;_`: _ -&gt; "Hello, World"
  }
  Object.new()
'</span>
<span class="c"># Hello, World</span>
</code></pre></div></div>

<hr />

<p>コードの値がストリームだった場合、各要素を1行ずつ出力します。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="s1">'1 .. 3'</span>
<span class="c"># 1</span>
<span class="c"># 2</span>
<span class="c"># 3</span>
</code></pre></div></div>

<hr />

<p>コードの戻り値が空ストリームである場合、何も出力されません。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="s1">'1 + 2; ,'</span>
</code></pre></div></div>

<h3 id="-q-戻り値の出力の抑制"><code class="language-plaintext highlighter-rouge">-q</code>: 戻り値の出力の抑制</h3>

<p><code class="language-plaintext highlighter-rouge">-q</code> オプションを指定すると、戻り値の出力が行われなくなります。</p>

<p>出力を行うには別途 <code class="language-plaintext highlighter-rouge">OUT</code> 関数などを使う必要があります。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="nt">-q</span> <span class="s1">'
  OUT &lt;&lt; "apple"
  OUT &lt;&lt; "banana"
  "orange"
'</span>
<span class="c"># apple</span>
<span class="c"># banana</span>
</code></pre></div></div>

<hr />

<p>厳密には、このオプションはソースコード全体を文（runner）コンテキストとして解釈することを指定するオプションです。</p>

<p>このため末尾式の部分に変数宣言文などの文が書けるようになります。</p>

<h2 id="スクリプトの指定">スクリプトの指定</h2>

<p>実行するXarpiteスクリプトの指定方法は起動コマンドと指定方法で6通りに別れます。</p>

<table>
  <thead>
    <tr>
      <th>起動コマンド</th>
      <th>スクリプトの指定方法</th>
      <th>記述例</th>
      <th>扱い</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">xarpite</code></td>
      <td>第一引数</td>
      <td><code class="language-plaintext highlighter-rouge">xarpite script.xa1 arg1 ...</code></td>
      <td>スクリプトファイル</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">xarpite</code></td>
      <td><code class="language-plaintext highlighter-rouge">-f</code></td>
      <td><code class="language-plaintext highlighter-rouge">xarpite -f script.xa1 arg1 ...</code></td>
      <td>スクリプトファイル</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">xarpite</code></td>
      <td><code class="language-plaintext highlighter-rouge">-e</code></td>
      <td><code class="language-plaintext highlighter-rouge">xarpite -e '1 + 2' arg1 ...</code></td>
      <td>スクリプト</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">xa</code></td>
      <td>第一引数</td>
      <td><code class="language-plaintext highlighter-rouge">xa '1 + 2' arg1 ...</code></td>
      <td>スクリプト</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">xa</code></td>
      <td><code class="language-plaintext highlighter-rouge">-f</code></td>
      <td><code class="language-plaintext highlighter-rouge">xa -f script.xa1 arg1 ...</code></td>
      <td>スクリプトファイル</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">xa</code></td>
      <td><code class="language-plaintext highlighter-rouge">-e</code></td>
      <td><code class="language-plaintext highlighter-rouge">xa -e '1 + 2' arg1 ...</code></td>
      <td>スクリプト</td>
    </tr>
  </tbody>
</table>

<h3 id="-f-ファイルからスクリプトを読み込む"><code class="language-plaintext highlighter-rouge">-f</code>: ファイルからスクリプトを読み込む</h3>

<p><code class="language-plaintext highlighter-rouge">-f &lt;scriptfile&gt;</code></p>

<p><code class="language-plaintext highlighter-rouge">-f</code> オプションを指定すると、指定したXarpiteスクリプトファイルからXarpiteスクリプトを読み込んで実行します。</p>

<p><code class="language-plaintext highlighter-rouge">USE</code> 関数とは異なり、 <code class="language-plaintext highlighter-rouge">scriptfile</code> が相対パスで指定された場合、カレントディレクトリを起点として解決されます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="o">{</span>
  <span class="nb">echo</span> <span class="s1">'100 + 20 + 3'</span> <span class="o">&gt;</span> script.xa1
  xa <span class="nt">-f</span> script.xa1
  <span class="nb">rm </span>script.xa1
<span class="o">}</span>
<span class="c"># 123</span>
</code></pre></div></div>

<hr />

<p><code class="language-plaintext highlighter-rouge">-f</code> オプションが指定された場合、第1引数はスクリプトに渡す引数の一部として解釈されます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="o">{</span>
  <span class="nb">echo</span> <span class="s1">'ARGS()'</span> <span class="o">&gt;</span> script.xa1
  xa <span class="nt">-f</span> script.xa1 <span class="s1">'100 + 20 + 3'</span> apple banana cherry
  <span class="nb">rm </span>script.xa1
<span class="o">}</span>
<span class="c"># 100 + 20 + 3</span>
<span class="c"># apple</span>
<span class="c"># banana</span>
<span class="c"># cherry</span>
</code></pre></div></div>

<hr />

<p><code class="language-plaintext highlighter-rouge">-f</code> オプションと <code class="language-plaintext highlighter-rouge">-e</code> オプションは排他的であり、同時に指定することはできません。</p>

<h3 id="-e-スクリプトを直接実行"><code class="language-plaintext highlighter-rouge">-e</code>: スクリプトを直接実行</h3>

<p><code class="language-plaintext highlighter-rouge">-e &lt;script&gt;</code></p>

<p><code class="language-plaintext highlighter-rouge">-e</code> オプションを指定すると、指定したXarpiteスクリプトを直接実行します。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xarpite <span class="nt">-e</span> <span class="s1">'100 + 20 + 3'</span>
<span class="c"># 123</span>
</code></pre></div></div>

<hr />

<p><code class="language-plaintext highlighter-rouge">-e</code> オプションが指定された場合、第1引数はスクリプトに渡す引数の一部として解釈されます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="nt">-e</span> <span class="s1">'ARGS()'</span> <span class="s1">'100 + 20 + 3'</span> apple banana cherry
<span class="c"># 100 + 20 + 3</span>
<span class="c"># apple</span>
<span class="c"># banana</span>
<span class="c"># cherry</span>
</code></pre></div></div>

<hr />

<p><code class="language-plaintext highlighter-rouge">-f</code> オプションと <code class="language-plaintext highlighter-rouge">-e</code> オプションは排他的であり、同時に指定することはできません。</p>

<h2 id="その他のコマンド">その他のコマンド</h2>

<h3 id="xarpite-update-xarpiteを最新版に更新する"><code class="language-plaintext highlighter-rouge">xarpite-update</code>: Xarpiteを最新版に更新する</h3>

<p>現在実行中のXarpiteを最新版に更新します。</p>

<p>このコマンドにはインストールディレクトリに書き込みを行う権限が必要です。</p>

<h2 id="cli版限定組み込み定数関数">CLI版限定組み込み定数・関数</h2>

<h3 id="args-コマンドライン引数を取得"><code class="language-plaintext highlighter-rouge">ARGS</code>: コマンドライン引数を取得</h3>

<p>コマンドライン引数が配列で格納されています。</p>

<p>最初の引数が添え字0に対応し、 <code class="language-plaintext highlighter-rouge">xa</code> コマンドやワンライナーのソースコードは含まれません。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="s1">'ARGS'</span> 1 2 3
<span class="c"># [1;2;3]</span>
</code></pre></div></div>

<h3 id="env-環境変数を取得"><code class="language-plaintext highlighter-rouge">ENV</code>: 環境変数を取得</h3>

<p>環境変数がオブジェクトとして格納されています。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ FOO</span><span class="o">=</span>bar xa <span class="s1">'ENV.FOO'</span>
<span class="c"># bar</span>
</code></pre></div></div>

<p>存在しない変数にアクセスした場合は <code class="language-plaintext highlighter-rouge">NULL</code> が返ります。</p>

<h3 id="in-コンソールから文字列を1行ずつ読み取る"><code class="language-plaintext highlighter-rouge">IN</code>: コンソールから文字列を1行ずつ読み取る</h3>

<p><code class="language-plaintext highlighter-rouge">IN: STREAM&lt;STRING&gt;</code></p>

<p>標準入力から文字列を1行ずつ読み取るストリームです。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="o">{</span> <span class="nb">echo </span>123<span class="p">;</span> <span class="nb">echo </span>456<span class="p">;</span> <span class="o">}</span> | xa <span class="s1">'IN'</span>
<span class="c"># 123</span>
<span class="c"># 456</span>
</code></pre></div></div>

<hr />

<p>ストリームは逐次的であるため、非常に大きな反復も少ないメモリ消費で行うことができます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="s1">'1 .. 10000 | "#" * 10000'</span> | xa <span class="s1">'IN | $#_ &gt;&gt; SUM'</span>
<span class="c"># 100000000</span>
</code></pre></div></div>

<hr />

<p>コンソールから1行だけ読み取るには、 <code class="language-plaintext highlighter-rouge">FIRST</code> 関数を使用します。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="o">{</span>
  <span class="nb">echo </span>123
  <span class="nb">echo </span>456
<span class="o">}</span> | xa <span class="nt">-q</span> <span class="s1">'
  OUT &lt;&lt; "1: $(FIRST(IN))"
  OUT &lt;&lt; "2: $(FIRST(IN))"
'</span>
<span class="c"># 1: 123</span>
<span class="c"># 2: 456</span>
</code></pre></div></div>

<p>ストリームは逐次的であるため、非常に大きな反復も少ないメモリ消費で行うことができます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="s1">'1 .. 10000 | "#" * 10000'</span> | xa <span class="s1">'IN | $#_ &gt;&gt; SUM'</span>
<span class="c"># 100000000</span>
</code></pre></div></div>

<hr />

<p><code class="language-plaintext highlighter-rouge">IN</code> を一度でも使用した場合、 <code class="language-plaintext highlighter-rouge">INB</code> を使用することはできません。</p>

<h3 id="inb-コンソールからバイトデータを読み取る"><code class="language-plaintext highlighter-rouge">INB</code>: コンソールからバイトデータを読み取る</h3>

<p><code class="language-plaintext highlighter-rouge">INB: STREAM&lt;BLOB&gt;</code></p>

<p>標準入力からバイトデータをBLOBとしてすべて読み取るストリームです。</p>

<p>BLOBは最大8192バイトの長さに分割されます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"abc"</span> | xa <span class="s1">'INB'</span>
<span class="c"># BLOB.of([97;98;99])</span>
</code></pre></div></div>

<hr />

<p><code class="language-plaintext highlighter-rouge">INB</code> を一度でも使用した場合、 <code class="language-plaintext highlighter-rouge">IN</code> を使用することはできません。</p>

<h3 id="out-コンソールに出力"><code class="language-plaintext highlighter-rouge">OUT</code>: コンソールに出力</h3>

<p><code class="language-plaintext highlighter-rouge">OUT(value: VALUE): NULL</code></p>

<p>標準出力に出力します。</p>

<p>この関数はしばしば左実行パイプ <code class="language-plaintext highlighter-rouge">&lt;&lt;</code> によって呼び出されます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="nt">-q</span> <span class="s1">'
  OUT(123)
  OUT &lt;&lt; 456
'</span>
<span class="c"># 123</span>
<span class="c"># 456</span>
</code></pre></div></div>

<hr />

<p>ストリームが指定された場合、各要素を1行ずつ出力します。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="nt">-q</span> <span class="s1">'
  OUT(1 .. 3)
'</span>
<span class="c"># 1</span>
<span class="c"># 2</span>
<span class="c"># 3</span>
</code></pre></div></div>

<hr />

<p><code class="language-plaintext highlighter-rouge">OUT</code> 関数自体は <code class="language-plaintext highlighter-rouge">NULL</code> を返します。</p>

<h3 id="outb-バイトデータをコンソールに出力"><code class="language-plaintext highlighter-rouge">OUTB</code>: バイトデータをコンソールに出力</h3>

<p><code class="language-plaintext highlighter-rouge">OUTB(blobLike: BLOB_LIKE): NULL</code></p>

<p><code class="language-plaintext highlighter-rouge">blobLike</code> をバイト列に変換し、バイト列のまま標準出力に出力します。</p>

<p>ストリームが与えられた場合は各要素を順にバイト列に変換し、順に出力します。</p>

<p>改行は自動的には付与されません。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="nt">-q</span> <span class="s1">'OUTB(BLOB.of([65, 66, 67, 10]), BLOB.of([68, 69, 70, 10]))'</span>
<span class="c"># ABC</span>
<span class="c"># DEF</span>
</code></pre></div></div>

<hr />

<p>それ以外の部分は概ね <code class="language-plaintext highlighter-rouge">OUT</code> 関数の仕様に準じます。</p>

<h3 id="files-ディレクトリ内のファイルの一覧を取得"><code class="language-plaintext highlighter-rouge">FILES</code>: ディレクトリ内のファイルの一覧を取得</h3>

<p><code class="language-plaintext highlighter-rouge">FILES(dir: STRING): STREAM&lt;STRING&gt;</code></p>

<p><code class="language-plaintext highlighter-rouge">dir</code> で指定されたディレクトリ直下のファイル名のストリームを取得します。</p>

<p>ファイル名にはディレクトリのパスは含まれません。</p>

<p>返されるファイルには <code class="language-plaintext highlighter-rouge">.</code> や <code class="language-plaintext highlighter-rouge">..</code> は含まれず、ディレクトリやその他の特殊なファイルは含まれます。</p>

<p>返されるファイル名は辞書順にソートされます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="o">{</span>
  <span class="nb">mkdir </span>tmp
  <span class="nb">touch </span>tmp/file
  <span class="nb">mkdir </span>tmp/dir
  xa <span class="s1">'FILES("tmp")'</span>
  <span class="nb">rm </span>tmp/file
  <span class="nb">rmdir </span>tmp/dir
  <span class="nb">rmdir </span>tmp
<span class="o">}</span>
<span class="c"># dir</span>
<span class="c"># file</span>
</code></pre></div></div>

<h3 id="read-ファイルから読み込み"><code class="language-plaintext highlighter-rouge">READ</code>: ファイルから読み込み</h3>

<p><code class="language-plaintext highlighter-rouge">READ(file: STRING): STREAM&lt;STRING&gt;</code></p>

<p><code class="language-plaintext highlighter-rouge">file</code> で指定されたテキストファイルの内容を文字列として1行ずつ読み込みます。</p>

<p>改行コードは除去されます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"apple"</span> <span class="o">&gt;</span> tmp.txt
  <span class="nb">echo</span> <span class="s2">"banana"</span> <span class="o">&gt;&gt;</span> tmp.txt
  xa <span class="s1">'READ("tmp.txt")'</span>
  <span class="nb">rm </span>tmp.txt
<span class="o">}</span>
<span class="c"># apple</span>
<span class="c"># banana</span>
</code></pre></div></div>

<h3 id="use-外部xarpiteファイルの結果を取得"><code class="language-plaintext highlighter-rouge">USE</code>: 外部Xarpiteファイルの結果を取得</h3>

<p><code class="language-plaintext highlighter-rouge">USE(file: STRING): VALUE</code></p>

<p>指定されたXarpiteスクリプトを評価した結果を返します。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="o">{</span>
  <span class="nb">echo</span> <span class="s1">'877'</span> <span class="o">&gt;</span> banana.xa1
  xa <span class="s1">'USE("./banana")'</span>
  <span class="nb">rm </span>banana.xa1
<span class="o">}</span>
<span class="c"># 877</span>
</code></pre></div></div>

<hr />

<p><code class="language-plaintext highlighter-rouge">file</code> は <code class="language-plaintext highlighter-rouge">./</code> で始まる必要があり、 <code class="language-plaintext highlighter-rouge">USE</code> 関数を呼び出したファイルからの相対パスとして解釈されます。</p>

<p>例えば、 <code class="language-plaintext highlighter-rouge">fruit/apple.xa1</code> 内で <code class="language-plaintext highlighter-rouge">USE("./banana")</code> と記述した場合、 <code class="language-plaintext highlighter-rouge">fruit/banana.xa1</code> が読み込まれます。</p>

<p><code class="language-plaintext highlighter-rouge">file</code> では拡張子の <code class="language-plaintext highlighter-rouge">.xa1</code> は省略可能です。 <code class="language-plaintext highlighter-rouge">USE("./banana")</code> と記述した場合、 <code class="language-plaintext highlighter-rouge">./banana</code> が存在すればそれ、そうでなければ <code class="language-plaintext highlighter-rouge">./banana.xa1</code> が読み込まれます。</p>

<p>コードがコマンドライン上で直接指定された場合、カレントディレクトリを起点としてファイルを解決します。</p>

<p>ディレクトリの区切り文字はそれが実行されるOSに関わらず <code class="language-plaintext highlighter-rouge">/</code> を使用します。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="o">{</span>
  <span class="nb">mkdir </span>modules
  <span class="nb">echo</span> <span class="s1">'
    {
      getBananaImpl: () -&gt; "Banana"
    }
  '</span> <span class="o">&gt;</span> modules/banana.xa1
  <span class="nb">echo</span> <span class="s1">'
    @USE("./banana")
    {
      getBanana: () -&gt; getBananaImpl()
    }
  '</span> <span class="o">&gt;</span> modules/fruit.xa1
  xa <span class="s1">'
    @USE("./modules/fruit")
    getBanana()
  '</span>
  <span class="nb">rm </span>modules/banana.xa1
  <span class="nb">rm </span>modules/fruit.xa1
  <span class="nb">rmdir </span>modules
<span class="o">}</span>
<span class="c"># Banana</span>
</code></pre></div></div>

<hr />

<p><code class="language-plaintext highlighter-rouge">USE</code> 関数の戻り値をマウントすることで、ディレクティブのような使用感を実現できます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="o">{</span>
  <span class="nb">echo</span> <span class="s1">'
    {
      FRUIT: 877
    }
  '</span> <span class="o">&gt;</span> banana.xa1
  xa <span class="s1">'
    @USE("./banana")
    FRUIT
  '</span>
  <span class="nb">rm </span>banana.xa1
<span class="o">}</span>
<span class="c"># 877</span>
</code></pre></div></div>

<hr />

<p>同一絶対ファイルパスに対する <code class="language-plaintext highlighter-rouge">USE</code> 関数の結果はキャッシュされ、同じ呼び出しによって再利用されます。</p>

<p>そのため、返されるインスタンスは常に同一であり、読み込み時の副作用も1度だけ生じます。</p>

<p>スクリプトの結果がストリームである場合、そのストリームは解決されます。</p>

<p>ファイル実体が同一でも、シンボリックリンクなどによって異なる絶対パス上にある場合、別のファイルとみなされます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="o">{</span>
  <span class="nb">echo</span> <span class="s1">'
    {
      variables: {
        fruit: "apple"
      }
    }
  '</span> <span class="o">&gt;</span> tmp.xa1
  xa <span class="nt">-q</span> <span class="s1">'
    a := USE("./tmp")
    b := USE("./tmp")
    OUT &lt;&lt; b.variables.fruit
    a.variables.fruit = "banana"
    OUT &lt;&lt; b.variables.fruit
  '</span>
  <span class="nb">rm </span>tmp.xa1
<span class="o">}</span>
<span class="c"># apple</span>
<span class="c"># banana</span>
</code></pre></div></div>

<hr />

<p><code class="language-plaintext highlighter-rouge">USE</code> されることを前提として記述されたファイルをモジュールと呼びます。</p>

<p>モジュールは多くの場合マウント用のオブジェクトを返すことでAPIを公開しますが、そうでない場合もあります。</p>

<p>モジュールの提供するAPIは、組み込みマウント風に大文字で書かれる場合もあれば、そうでない場合もあります。</p>

<h3 id="exec-外部コマンドを実行-experimental"><code class="language-plaintext highlighter-rouge">EXEC</code>: 外部コマンドを実行 [EXPERIMENTAL]</h3>

<p><code class="language-plaintext highlighter-rouge">EXEC(command: STREAM&lt;STRING&gt;): STREAM&lt;STRING&gt;</code></p>

<p>外部コマンドを実行します。</p>

<p><code class="language-plaintext highlighter-rouge">command</code> にはプロセスおよびその引数を1要素ずつ指定します。</p>

<p>戻り値はそのプロセスの標準出力を1行ずつ読み取るストリームです。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="nt">--jvm</span> <span class="s1">'EXEC("echo", "Hello, World!")'</span>
<span class="c"># Hello, World!</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="nt">--jvm</span> <span class="s1">'EXEC("bash", "-c", "seq 1 30 | grep 3")'</span>
<span class="c"># 3</span>
<span class="c"># 13</span>
<span class="c"># 23</span>
<span class="c"># 30</span>
</code></pre></div></div>

<hr />

<p>呼び出したプロセスが0以外の終了コードで終了した場合、例外をスローします。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="nt">--jvm</span> <span class="s1">'EXEC("bash", "-c", "exit 1") !? "ERROR"'</span>
<span class="c"># ERROR</span>
</code></pre></div></div>

<hr />

<p>呼び出したプロセスの標準エラー出力はXarpiteの標準エラー出力にリダイレクトされます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xa <span class="nt">--jvm</span> <span class="nt">-q</span> <span class="s1">'EXEC("bash", "-c", "echo '</span>ERROR<span class="s1">' 1&gt;&amp;2")'</span> 2&gt;&amp;1
<span class="c"># ERROR</span>
</code></pre></div></div>

<hr />

<p>呼び出したプロセスは別のスレッドで管理され、メインスレッドはブロッキングせずにサスペンドします。</p>

<hr />

<p>この関数は実験的な機能であり、将来的に仕様が変更される可能性があります。</p>

<p>戻り値は、プロセスの標準出力を逐次的に読み取るストリームではなく、プロセスの終了後にその標準出力を行分割したものです。</p>

<p><strong>また、この関数は現状JVM版でのみ提供されます。</strong></p>

                        
                    
                </article>
            </div>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <p class="footer-text">
                    &copy; 2024-2025 <a href="https://github.com/MirrgieRiana" target="_blank" class="footer-link">MirrgieRiana</a>.
                    <a href="https://github.com/MirrgieRiana/xarpite" target="_blank" class="footer-link">GitHub</a>
                </p>
            </div>
        </div>
    </footer>
</div>
</body>
</html>
